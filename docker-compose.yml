# =============================================================================
# Docker Compose Configuration for Pitch Perfect V2
# For local development and testing
# =============================================================================

services:
  # Main application service
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: runner
      args:
        NODE_ENV: production
        NEXT_TELEMETRY_DISABLED: 1
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PORT=3000
      - HOSTNAME=0.0.0.0
    healthcheck:
      test: ["CMD", "node", "apps/web/healthcheck.js"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 20s
    restart: unless-stopped
    networks:
      - pitch-perfect-network

  # Development service with hot reload
  dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: deps
    ports:
      - "3001:3000"
      - "9229:9229"  # Node.js debugging port
    environment:
      - NODE_ENV=development
      - PORT=3000
      - HOSTNAME=0.0.0.0
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next  # Persist Next.js build cache
    command: ["yarn", "dev"]
    networks:
      - pitch-perfect-network
    profiles:
      - dev

networks:
  pitch-perfect-network:
    driver: bridge

# =============================================================================
# Usage Instructions:
# 
# Production build:
#   docker-compose up app
# 
# Development with hot reload:
#   docker-compose --profile dev up dev
# 
# Build only:
#   docker-compose build
# 
# Clean up:
#   docker-compose down
#   docker-compose down --volumes --rmi all
# ============================================================================= 